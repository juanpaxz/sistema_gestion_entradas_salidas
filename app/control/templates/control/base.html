{% load static %}
{% load group_tags %}
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Sistema de Control de Incidencias{% endblock %}</title>
    <!-- Bootstrap 5 CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-" crossorigin="anonymous">
    <!-- Project theme CSS (moved from inline styles) -->
    <link rel="stylesheet" href="{% static 'control/css/theme.css' %}">
    {% block extra_head %}{% endblock %}
  </head>
  <body>

  {% include 'control/_navbar.html' %}

  <main class="container mt-4">
    {% block content %}
    {% endblock %}
  </main>

  <!-- Bootstrap 5 JS (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-" crossorigin="anonymous"></script>
  {% block extra_js %}{% endblock %}

  <script>
    // Theme (dark/light) toggle - stores selection in localStorage
    (function(){
      const storageKey = 'theme';
      const root = document.documentElement;
      const body = document.body;
      function applyTheme(theme){
        if(theme === 'dark'){
          body.classList.add('dark');
          const btn = document.getElementById('theme-toggle'); if(btn) btn.innerHTML = '‚òÄÔ∏è';
        } else {
          body.classList.remove('dark');
          const btn = document.getElementById('theme-toggle'); if(btn) btn.innerHTML = 'üåô';
        }
      }
      // init
      try{
        const saved = localStorage.getItem(storageKey) || 'light';
        applyTheme(saved);
      }catch(e){ /* ignore */ }

      // attach to toggle button (if present)
      document.addEventListener('DOMContentLoaded', function(){
        const toggle = document.getElementById('theme-toggle');
        if(!toggle) return;
        toggle.addEventListener('click', function(e){
          const isDark = document.body.classList.contains('dark');
          const next = isDark ? 'light' : 'dark';
          try{ localStorage.setItem(storageKey, next); }catch(err){}
          applyTheme(next);
        });
      });
    })();
  </script>
  </body>
</html>
