{% load static %}
{% load group_tags %}
<!doctype html>
<html lang="es">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>{% block title %}Sistema de Control de Incidencias{% endblock %}</title>
    <!-- Bootstrap 5 CSS (CDN) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-" crossorigin="anonymous">
    <style>
      /* Paleta de colores del proyecto */
      :root{
        --brand-primary: #2D8BD2;
        --brand-danger: #AD2525;
        --brand-accent: #FFE95C;
        /* Map to Bootstrap CSS variables */
        --bs-primary: var(--brand-primary);
        --bs-danger: var(--brand-danger);
        --bs-warning: var(--brand-accent);
      }

      .navbar-brand { color: var(--bs-primary) !important; }
      .btn-primary {
        background-color: var(--bs-primary) !important;
        border-color: var(--bs-primary) !important;
      }
      .text-accent { color: var(--brand-accent); }
      /* Dark mode tweaks */
      body.dark{
        background-color: #0f1720; /* near-black with bluish tint */
        color: #e6eef6;
      }
      /* Cards and panels */
      body.dark .card{
        background-color: #0b1220; /* slightly lighter than body */
        border: 1px solid rgba(255,255,255,0.06);
        color: #e6eef6;
        box-shadow: none;
      }
  /* keep explicit stat-card backgrounds intact; only make non-stat cards transparent */
  body.dark .card:not(.stat-card) .card-body { background: transparent; }
      body.dark .card .card-title { color: #dbeeff; }
      /* Muted text should be visible on dark background */
      body.dark .text-muted { color: rgba(230,238,246,0.6) !important; }
      /* Headings / big numbers */
      body.dark .display-6 { color: #dff1ff; }
      /* Buttons */
      body.dark .btn-primary {
        background-color: var(--bs-primary) !important;
        border-color: var(--bs-primary) !important;
        color: #052235;
      }
      body.dark .btn-outline-primary {
        color: var(--bs-primary) !important;
        border-color: rgba(255,255,255,0.12) !important;
        background: transparent;
      }
      body.dark .btn-outline-light {
        color: #fff !important;
        border-color: rgba(255,255,255,0.12) !important;
      }
      /* Dropdowns and menus */
      body.dark .dropdown-menu{
        background-color: #0b1220;
        border: 1px solid rgba(255,255,255,0.06);
        color: #e6eef6;
      }
      body.dark a { color: #9fd7ff; }
      body.dark .navbar{
        filter: brightness(0.95);
      }
    </style>
    {% block extra_head %}{% endblock %}
  </head>
  <body>

  {% include 'control/_navbar.html' %}

  <main class="container mt-4">
    {% block content %}
    {% endblock %}
  </main>

  <!-- Bootstrap 5 JS (CDN) -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-" crossorigin="anonymous"></script>
  {% block extra_js %}{% endblock %}

  <script>
    // Theme (dark/light) toggle - stores selection in localStorage
    (function(){
      const storageKey = 'theme';
      const root = document.documentElement;
      const body = document.body;
      function applyTheme(theme){
        if(theme === 'dark'){
          body.classList.add('dark');
          const btn = document.getElementById('theme-toggle'); if(btn) btn.innerHTML = '‚òÄÔ∏è';
        } else {
          body.classList.remove('dark');
          const btn = document.getElementById('theme-toggle'); if(btn) btn.innerHTML = 'üåô';
        }
      }
      // init
      try{
        const saved = localStorage.getItem(storageKey) || 'light';
        applyTheme(saved);
      }catch(e){ /* ignore */ }

      // attach to toggle button (if present)
      document.addEventListener('DOMContentLoaded', function(){
        const toggle = document.getElementById('theme-toggle');
        if(!toggle) return;
        toggle.addEventListener('click', function(e){
          const isDark = document.body.classList.contains('dark');
          const next = isDark ? 'light' : 'dark';
          try{ localStorage.setItem(storageKey, next); }catch(err){}
          applyTheme(next);
        });
      });
    })();
  </script>
  </body>
</html>
